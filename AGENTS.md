# 项目概述 Pʀᴏᴊᴇᴄᴛ Oᴠᴇʀᴠɪᴇᴡ

**THU-Questionnaire-Downloader** 是一个基于 Python 的自动化工具，专为清华大学调查问卷系统设计，用于高效地批量下载问卷调查结果。与普通下载工具不同，它集成了浏览器自动化、数据解析、多媒体资源（图片、云盘视频）下载以及 Markdown/PDF 报告生成功能。

项目架构包含两个核心脚本：
1.  **`main.py`**：作为程序入口，负责配置加载、路径管理、外部工具调用以及最终的文档聚合与转换。
2.  **`thu_questionnaire_downloader.py`**：封装了核心业务逻辑，包括基于 `DrissionPage` 的网页交互、HTML 解析、资源提取与文件写入。

数据流向清晰明确：从配置读取开始，经历模拟登录、数据抓取、附件下载（图片直接下载，视频通过子进程调用外部工具），最终汇总为结构化的 Markdown 文件并转为 PDF。

# 构建和测试命令 Bᴜɪʟᴅ & Tᴇsᴛ Cᴏᴍᴍᴀɴᴅs

本项目为纯 Python 脚本工具，无需编译构建，但依赖外部环境与工具配置。

-   **依赖安装**：
    确保 Python 3.8+ 环境，并安装必要的库：
    ```bash
    pip install DrissionPage rich pypandoc requests
    ```

-   **运行命令**：
    直接执行入口脚本：
    ```bash
    python main.py
    ```

-   **外部工具集成**：
    项目依赖 `THU-Cloud-Downloader` 处理云盘链接。测试前请确保该工具路径已在 `config.json` 中正确配置，且该工具可独立运行。

# 代码风格指南 Cᴏᴅᴇ Sᴛʏʟᴇ Gᴜɪᴅᴇ

-   **Python 风格**：遵循 PEP 8 规范。
-   **注释**：关键逻辑块（如 DOM 解析、正则匹配）需添加注释说明。
-   **类型提示**：鼓励使用 Python 类型提示 (Type Hints) 以增强代码可读性。
-   **日志记录**：统一使用 `logging` 模块。调试信息使用 `DEBUG` 级别，关键流程（如保存文件、登录成功）使用 `INFO` 级别。
-   **异常处理**：网络请求与文件操作需包裹在 `try-except` 块中，确保单一任务失败不中断整体流程。

# 测试说明 Tᴇsᴛ Iɴsᴛʀᴜᴄᴛɪᴏɴs

由于项目依赖实时网页结构和外部云盘状态，主要的测试方式为集成测试：

1.  **配置测试**：准备一个包含 `config.json` 的测试目录，填入有效的问卷 ID 和密码。
2.  **全流程测试**：运行 `main.py`，观察是否能成功登录、翻页、解析数据。
3.  **结果验证**：
    -   检查 `output` 目录下是否生成了 `booking_info.md` 和 PDF。
    -   验证子文件夹中是否包含对应的 `.jpg` 图片和 `.mp4` 视频。
    -   **关键点**：检查 Markdown 中的文件路径链接在 VS Code 中是否可点击（需符合 `<file:///>` 格式）。

# 安全注意事项 Sᴇᴄᴜʀɪᴛʏ Cᴏɴsɪᴅᴇʀᴀᴛɪᴏɴs

-   **凭证管理**：`config.json` 包含明文密码，请确该文件被添加到 `.gitignore` 中，严禁提交到版本控制系统。
-   **子进程安全**：`main.py` 中使用了 `subprocess` 调用外部脚本。在 Windows 环境下，必须显式设置 `encoding='utf-8'` 和环境变量 `PYTHONIOENCODING=utf-8`，以防止 GBK 编码输出导致的解码崩溃。
-   **文件操作**：工具会覆盖目标文件夹中的同名文件，建议在配置 `save_dir` 时指定独立目录，避免数据意外丢失。
